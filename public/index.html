<!DOCTYPE html>
<html lang="id">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AI Soal Scanner</title>
  <style>
    :root{
      --bg:#020617; --card:#0b1220; --muted:#94a3b8; --primary:#22c55e; --border:#1f2937;
      --grad: linear-gradient(135deg,#22c55e,#0ea5e9);
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh; padding:16px;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background:
        radial-gradient(800px 400px at 10% -10%, #0ea5e933, transparent 40%),
        radial-gradient(600px 300px at 90% 10%, #22c55e22, transparent 40%),
        #020617;
      color:#e5e7eb;
    }
    .wrap{max-width:820px; margin:0 auto}
    .card{
      background:rgba(11,18,32,.9); backdrop-filter: blur(8px);
      border:1px solid var(--border); border-radius:16px; padding:16px; margin-bottom:12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    h1{margin:.2rem 0 .4rem; font-size:1.25rem}
    p{margin:.2rem 0 .8rem; color:var(--muted)}
    .row{display:grid; gap:10px}
    .grid{display:grid; gap:12px}
    @media(min-width:720px){ .grid-2{grid-template-columns:1fr 1fr} }
    .btn{
      border:1px solid var(--border); border-radius:12px; padding:12px 14px;
      background:#020617; color:#e5e7eb; font-weight:700;
    }
    .btn.primary{background:var(--grad); color:#052e16; border:none}
    .btn.ghost{background:transparent}
    .btn:disabled{opacity:.6}
    input[type=file], input[type=number], textarea{
      width:100%; background:#020617; color:#e5e7eb;
      border:1px solid var(--border); border-radius:12px; padding:10px;
    }
    textarea{min-height:120px; resize:vertical}
    .label{font-size:.8rem; color:var(--muted); margin-bottom:6px}
    .actions{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .hint{font-size:.8rem; color:var(--muted)}
    .loading{display:none; align-items:center; gap:8px}
    .dot{width:8px; height:8px; background:#22c55e; border-radius:50%; animation:blink 1.4s infinite both}
    .dot:nth-child(2){animation-delay:.2s} .dot:nth-child(3){animation-delay:.4s}
    @keyframes blink{0%{opacity:.2} 20%{opacity:1} 100%{opacity:.2}}
    a.link{color:#22c55e; font-weight:700; text-decoration:none}
    .badge{display:inline-block; padding:4px 8px; border-radius:999px; background:#052e16; color:#86efac; border:1px solid #14532d; font-size:.75rem}
    .footer{opacity:.7; text-align:center; font-size:.75rem}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <span class="badge">Mobile-first</span>
      <h1>ðŸ“¸ AI Soal Scanner</h1>
      <p>Upload media dari HP (kamera / galeri). Sistem memisahkan <b>Soal</b> & <b>Jawaban</b>, lalu bisa kamu cetak ke Word.</p>

      <div class="row">
        <!-- 1) Ambil media dari HP -->
        <input id="file" type="file" accept="image/*" capture="environment" />

        <!-- 3) Input jumlah soal -->
        <div class="grid grid-2">
          <div>
            <div class="label">Jumlah Soal Pilihan Ganda</div>
            <input id="pgCount" type="number" min="0" placeholder="contoh: 20">
          </div>
          <div>
            <div class="label">Jumlah Soal Essay</div>
            <input id="essayCount" type="number" min="0" placeholder="contoh: 5">
          </div>
        </div>

        <div class="actions">
          <button id="btn" class="btn primary" onclick="upload()">ðŸš€ Proses</button>
          <span id="loading" class="loading">
            <span class="dot"></span><span class="dot"></span><span class="dot"></span>
            <span class="hint">Memprosesâ€¦</span>
          </span>
        </div>

        <!-- 4) Tips diarahkan ke kertas & tulisan -->
        <p class="hint">
          Tips: foto <b>terang</b>, <b>lurus ke kertas</b>, fokus ke <b>tulisan di kertas</b> (bukan ke area soal/jawaban tertentu),
          hindari bayangan & blur.
        </p>
      </div>
    </div>

    <div class="card grid grid-2">
      <div>
        <div class="label">ðŸ“Œ Soal</div>
        <textarea id="soal" placeholder="Hasil soal akan muncul di siniâ€¦"></textarea>
      </div>
      <div>
        <div class="label">âœ… Jawaban</div>
        <textarea id="jawaban" placeholder="Hasil jawaban akan muncul di siniâ€¦"></textarea>
      </div>
      <div class="actions">
        <!-- 2) Download Word + cetak -->
        <a id="download" class="link" style="display:none;" target="_blank">â¬‡ Download Word</a>
        <button class="btn ghost" onclick="printWord()">ðŸ–¨ Cetak</button>
      </div>
    </div>

    <div class="footer">Built with âš¡ â€” AI Soal Scanner</div>
  </div>

  <script>
    async function upload(){
      const file = document.getElementById("file").files[0];
      if(!file) return alert("Pilih media dulu ya");

      const pgCount = document.getElementById("pgCount").value || 0;
      const essayCount = document.getElementById("essayCount").value || 0;

      const btn = document.getElementById("btn");
      const loading = document.getElementById("loading");
      btn.disabled = true; loading.style.display = "inline-flex";

      const formData = new FormData();
      formData.append("image", file);
      formData.append("pgCount", pgCount);
      formData.append("essayCount", essayCount);

      try{
        const res = await fetch("/upload", { method:"POST", body: formData });
        const data = await res.json();

        document.getElementById("soal").value = data.soal || "";
        document.getElementById("jawaban").value = data.jawaban || "";

        const dl = document.getElementById("download");
        if(data.download){
          dl.href = data.download;
          dl.style.display = "inline-block";
        }
      }catch(e){
        alert("Gagal memproses. Coba foto lain / cek koneksi.");
      }finally{
        btn.disabled = false; loading.style.display = "none";
      }
    }

    // 2) Cetak Word: buka file Word, lalu print dari viewer HP
    function printWord(){
      const dl = document.getElementById("download");
      if(!dl.href) return alert("Download Word dulu ya");
      window.open(dl.href, "_blank");
    }
  </script>
</body>
</html>
